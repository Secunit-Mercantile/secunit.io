---
import { type CollectionEntry, getCollection, render } from "astro:content";

// layout
import BaseLayout from "@/layouts/BaseLayout.astro";

// components
import ExternalLink from "@/components/markdown-components/ExternalLink.astro";
import Admonition from "@/components/admonition/Admonition.astro";

// utils
import { filterCollectionByLanguage } from "@/js/localeUtils";
import { defaultLocale } from "@/config/siteSettings.json";

export const prerender = true;

export async function getStaticPaths() {
 const otherPages: CollectionEntry<"otherPages">[] = await getCollection(
  "otherPages",
  ({ data }) => {
   // filter out draft pages
   return data.draft !== true;
  },
 );

 // get rid of pages from other languages and remove locale from slug
 const filteredPages = filterCollectionByLanguage(otherPages, defaultLocale);

 return filteredPages.map((page) => ({
  params: { page: page.id },
  props: page,
 }));
}

type Props = CollectionEntry<"otherPages">;
const page = Astro.props as Props;

// convert markdown to html
const { Content } = await render(page);
const { title, description } = page.data;
---

<BaseLayout title={title} description={description}>
 <div class="mx-auto max-w-3xl px-4 md:px-8">
  <div class="mx-auto mb-20 max-w-2xl pt-10 text-center">
   <h1 class="h1 mb-4">{title}</h1>
   <p class="text-muted-foreground">{description}</p>
  </div>
  <div class="markdown-content mx-auto mb-16 max-w-3xl">
   <Content components={{ a: ExternalLink, Admonition: Admonition }} />
  </div>
 </div>
</BaseLayout>
