---
import { type CollectionEntry } from "astro:content";

// component imports
import BaseHead from "@/layouts/BaseHead.astro";
import Nav from "@/components/nav/Nav.astro";
import Footer from "@/components/footer/Footer.astro";
import CookieConsent from "@/components/cookie-consent/CookieConsent.astro";

// style import
import "@/styles/global.css";

// utils
import { getLocaleFromUrl } from "@/js/localeUtils";

// data
import siteSettings from "@/config/siteSettings.json";

// heroImage and authorData are defined on blog posts
// authorData could also be defined on the about author page
interface Props {
 type?: "blog" | "general";
 title: string;
 description: string;
 heroImage?: ImageMetadata;
 authorsData?: CollectionEntry<"authors">[];
 postFrontmatter?: CollectionEntry<"blog">["data"];
 noindex?: boolean; // you need to opt-in to no indexing, as it hides the page from search engines
}

const {
 type = "general",
 title,
 description,
 heroImage,
 authorsData,
 postFrontmatter,
 noindex = false,
} = Astro.props as Props;

const currLocale = getLocaleFromUrl(Astro.url);
---

<!doctype html>
<html
 lang={currLocale}
 class:list={["dark", siteSettings.useAnimations && "use-animations"]}
 transition:animate="fade"
>
 <head>
  <BaseHead
   type={type}
   title={title}
   description={description}
   image={heroImage ? heroImage : undefined}
   authors={authorsData ? authorsData : undefined}
   postFrontmatter={postFrontmatter ? postFrontmatter : undefined}
   noindex={noindex}
  />
 </head>
 <body id="body">
  <!-- put cookie consent first so it is seen first by screen readers -->
  <!-- <CookieConsent /> -->
  <div id="page" class="min-h-[100lvh]">
   <Nav />
   <main class="relative overflow-x-clip">
    <slot />
   </main>
   <!-- glow effect at the top of each page -->
   <aside aria-hidden="true" class="absolute inset-x-0 top-0">
    <div class="site-container relative flex">
     <div
      class="bg-primary-400/40 dark:bg-base-600/80 pointer-events-none absolute -top-[130px] left-20 aspect-square w-[min(220px,60vw)] overflow-hidden rounded-full blur-[80px] md:left-50 xl:left-60"
     >
     </div>
    </div>
   </aside>
   <Footer />
  </div>

  <!-- Scroll animations -->
  <script>
   import siteSettings from "@/config/siteSettings.json";
   import initTiltCards from "@/js/tiltCard";
   import { MOS } from "motion-on-scroll";

   if (siteSettings.useAnimations === true) {
    // runs on initial page load
    MOS.init({
     offset: 100,
     duration: 0.7,
     timeUnits: "s",
     distance: 20,
     delay: 0,
     easing: "ease-out-cubic",
     once: true,
     mirror: false,
    });

    // runs on view transitions navigation
    document.addEventListener("astro:after-swap", MOS.refreshHard);
   }

   // Initialize on page load
   initTiltCards();

   // Re-initialize after Astro view transitions
   document.addEventListener("astro:after-swap", initTiltCards);
  </script>
 </body>
</html>
