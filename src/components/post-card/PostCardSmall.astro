---
import { getLocalizedRoute } from "@/js/translationUtils";
import { type CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import type { HTMLAttributes } from "astro/types";

// utils
import { formatDate } from "@/js/textUtils";
import { getLocaleFromUrl } from "@/js/localeUtils";

interface Props extends HTMLAttributes<"article"> {
 post: CollectionEntry<"blog">;
 class?: string;
}

const { post, class: className, ...rest } = Astro.props as Props;
const { title, pubDate, heroImage } = post.data;

const currLocale = getLocaleFromUrl(Astro.url);
---

<article data-pagefind-ignore class:list={["@container w-full p-4", className]} {...rest}>
 <div class="grid grid-cols-4 items-center gap-2 @md:gap-4">
  <div class="col-span-1">
   <a href={getLocalizedRoute(currLocale, `/blog/${post.id}/`)}>
    {
     heroImage ? (
      <div class="aspect-[17/20] overflow-hidden rounded-3xl">
       <Image
        class="h-full w-full transform object-cover transition duration-1000 hover:scale-125"
        src={heroImage}
        alt={title}
        height={200}
        densities={[1.5, 2]}
       />
      </div>
     ) : (
      <div class="bg-gradient-radial-dark flex aspect-[17/20] items-center justify-center rounded-3xl">
       <div class="p-4 text-center">
        <Icon
         name="tabler/article"
         class="text-muted-foreground/70 mx-auto mb-3 h-12 w-12"
        />
        <h3 class="text-muted-foreground text-xs font-medium">{title}</h3>
       </div>
      </div>
     )
    }
   </a>
  </div>
  <div class="col-span-3 flex-1 p-2 @md:p-4">
   <time datetime={pubDate.toISOString()} class="text-muted-foreground mb-2 text-xs">
    {formatDate(pubDate, currLocale)}
   </time>
   <a href={getLocalizedRoute(currLocale, `/blog/${post.id}/`)}>
    <h3 class="font-heading tracking-2xl text-xs hover:underline">
     {title}
    </h3>
   </a>
  </div>
 </div>
</article>
