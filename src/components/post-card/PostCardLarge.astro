---
import { getLocalizedRoute } from "@/js/translationUtils";
import { type CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import { Icon } from "astro-icon/components";
import CategoryBadge from "../category/CategoryBadge.astro";
import type { HTMLAttributes } from "astro/types";

// utils
import { formatDate } from "@/js/textUtils";
import { getLocaleFromUrl } from "@/js/localeUtils";

interface Props extends HTMLAttributes<"article"> {
 post: CollectionEntry<"blog">;
 class?: string;
}

const { post, class: className, ...rest } = Astro.props as Props;
const { title, description, categories, pubDate, heroImage } = post.data;

const currLocale = getLocaleFromUrl(Astro.url);
---

<article class:list={["w-full p-10 md:w-1/2", className]} data-pagefind-ignore {...rest}>
 <a href={getLocalizedRoute(currLocale, `/blog/${post.id}/`)}>
  {
   heroImage ? (
    <div class="rounded-5xl mb-8 aspect-[5/4] overflow-hidden">
     <Image
      class="h-full w-full transform object-cover transition duration-1000 hover:scale-125"
      src={heroImage}
      alt={title}
      height={600}
      densities={[1.5, 2]}
     />
    </div>
   ) : (
    <div class="rounded-5xl bg-gradient-radial-dark mb-8 flex aspect-[5/4] items-center justify-center">
     <div class="p-6 text-center">
      <Icon name="tabler/article" class="text-muted-foreground/70 mx-auto mb-4 h-16 w-16" />
      <h3 class="text-muted-foreground h3 font-medium">{title}</h3>
     </div>
    </div>
   )
  }
 </a>
 <div class="text-muted-foreground mb-4 flex flex-wrap items-center gap-2">
  <div class="w-auto">
   <span class="text-xs tracking-tighter">Blog Post</span>
  </div>
  <div class="w-auto">&bull;</div>
  <div class="w-auto">
   <time datetime={pubDate.toISOString()} class="text-xs">
    {formatDate(pubDate, currLocale)}
   </time>
  </div>
 </div>
 <a href={getLocalizedRoute(currLocale, `/blog/${post.id}/`)} class="group mb-4 block">
  <h3 class="font-heading tracking-3xl text-xs hover:underline">
   {title}
  </h3>
 </a>
 <p class="text-muted-foreground mb-6">
  {description}
 </p>
 <div class="flex flex-wrap gap-3">
  {categories?.map((category) => <CategoryBadge category={category} />)}
 </div>
</article>
