---
// components
import NavLink from "@/components/nav/NavLink.astro";
import NavDropdownToggle from "@/components/nav/NavDropdown/NavDropdownToggle.astro";
import MegaMenuDropdownToggle from "./NavDropdown/MegaMenuDropdownToggle.astro";
import MobileNav from "@/components/nav/MobileNav/MobileNav.astro";
import SiteLogo from "@/components/site-logo/SiteLogo.astro";
import Button from "@/components/button/Button.astro";
import LanguageSelect from "@/components/language-select/LanguageSelect.astro";
import ThemeToggle from "@/components/theme-toggle/ThemeToggle.astro";

// utils
import { getLocaleFromUrl } from "@/js/localeUtils";
import { getTranslatedData } from "@/js/translationUtils";

// data
const currLocale = getLocaleFromUrl(Astro.url);
const navData = getTranslatedData("navData", currLocale);
import { locales } from "@/config/siteSettings.json";
// console.log(JSON.stringify(navData, null, 2));
---

<section
  id="nav"
  class:list={[
    "navbar--initial relative -top-px z-30 flex h-20 w-full flex-col border-b transition-all duration-300 md:mt-3",
    "data-[scrolled=false]:border-b-transparent data-[scrolled=false]:bg-transparent",
    "data-[scrolled=true]:border-foreground/10 data-[scrolled=true]:bg-background data-[scrolled=true]:sticky",
    "data-[scrolled=true]:animate-in data-[scrolled=true]:slide-in-from-top-10 data-[scrolled=true]:duration-500",
  ]}
  data-scrolled={false}
>
  <div class="flex h-full w-full">
    <div class="site-container flex w-full items-center">
      <header class="relative flex w-full items-center gap-2">
        <!-- home button / image -->
        <div class="flex h-full flex-auto justify-start">
          <SiteLogo />
        </div>

        <!-- <div class="flex flex-auto justify-center">
           
        </div> -->

        <!-- desktop nav menu -->
        <div>
          <div class="flex h-full flex-auto justify-end gap-4">
            <nav class="hidden md:block">
              <ul class="flex h-full items-center">
                {
                  // if dropdown exists, setup the dropdown, otherwise it is just a link
                  navData.map((navItem) =>
                    "dropdown" in navItem ? (
                      // non-mobile dropdown menu
                      <NavDropdownToggle navItem={navItem} />
                    ) : "megaMenuColumns" in navItem ? (
                      <MegaMenuDropdownToggle {navItem} />
                    ) : (
                      // normal nav link
                      <NavLink {navItem} />
                    ),
                  )
                }
              </ul>
            </nav>
            <div class="hidden items-center gap-2 md:flex">
              <!-- don't forget to also update the button in MobileNav.astro! -->
              <Button
                variant="outline"
                href="/contact"
                class="whitespace-nowrap">Let's Talk</Button
              >

              <ThemeToggle class="" />
            </div>

            <!-- mobile nav menu, only load on small screens where it is visible -->
            <div class="flex items-center md:hidden">
              <MobileNav />
            </div>
          </div>
        </div>
      </header>
    </div>
  </div>
</section>

{/*script on scrolldown to make navbar more legible*/}
<script>
  let navbar: HTMLElement | null;

  function scrollHandler() {
    if (navbar) {
      if (window.scrollY > 350) {
        navbar.setAttribute("data-scrolled", "true");
      } else {
        navbar.setAttribute("data-scrolled", "false");
      }
    }
  }

  function initNav() {
    navbar = document.getElementById("nav");
    window.addEventListener("scroll", scrollHandler, { passive: true });
  }

  // runs on initial page load
  initNav();

  // runs on view transitions navigation. Not needed if item has "transition:persist"
  document.addEventListener("astro:after-swap", initNav);
</script>
